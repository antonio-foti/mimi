#!/bin/bash

# rua - minimal AUR helper
# Usage: rua <aur-package-link>

# Check if argument is provided and looks like an AUR URL
if [ $# -eq 0 ] || ! [[ "$1" =~ ^https?://aur.archlinux.org/.*\.git$ ]]; then
    echo "Usage: rua <aur-package-link>"
    echo "Example: rua https://aur.archlinux.org/package-name.git"
    exit 1
fi

# Create ~/rua directory if it doesn't exist
RUADIR="$HOME/rua"
mkdir -p "$RUADIR" || {
    echo "Failed to create directory '$RUADIR'"
    exit 1
}

# Extract package name from the URL
package_name=$(basename "$1" .git)

# Clone the AUR repository into ~/rua/
echo "Cloning into $RUADIR/$package_name..."
git clone "$1" "$RUADIR/$package_name" || {
    echo "Failed to clone repository (invalid URL or no internet?)"
    exit 1
}

# Enter the directory
cd "$RUADIR/$package_name" || {
    echo "Failed to enter directory $RUADIR/$package_name"
    exit 1
}

# Build and install with makepkg (user runs sudo manually)
# -s: Install dependencies
# -i: Install the package
# -c: Clean up after build
# --noconfirm: Skip prompts
echo "Building and installing $package_name..."
makepkg -sic || {
    echo "Failed to build/install package (check PKGBUILD?)"
    echo "Note: Run 'makepkg -si' manually if dependencies need sudo."
    exit 1
}

echo "Successfully installed $package_name from $RUADIR/$package_name"
