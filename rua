#!/bin/bash

# rua - minimal AUR helper
# Usage: rua <aur-package-link>

# Check if argument is provided
if [ $# -eq  ]; then
    echo "Usage: rua <aur-package-link>"
    exit 1
fi

# Create ~/rua directory if it doesn't exist
RUADIR="$HOME/rua"
mkdir -p "$RUADIR" || {
    echo "Failed to create directory '$RUADIR'"
    exit 1
}

# Extract package name from the URL
package_name=$(basename "$1" .git)

# Clone the AUR repository into ~/rua/
echo "Cloning into $RUADIR/$package_name..."
git clone "$1" "$RUADIR/$package_name" || {
    echo "Failed to clone repository"
    exit 1
}

# Enter the directory
cd "$RUADIR/$package_name" || {
    echo "Failed to enter directory $RUADIR/$package_name"
    exit 1
}

# Build and install with makepkg
# -s: install dependencies using sudo
# -i: install the package
# -c: clean up after build
# --noconfirm: don't ask for confirmation
echo "Building and installing $package_name..."
sudo -S makepkg -sic --noconfirm || {
    echo "Failed to build/install package"
    exit 1
}

echo "Successfully installed $package_name from $RUADIR/$package_name"

